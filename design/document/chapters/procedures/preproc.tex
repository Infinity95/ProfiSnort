
In dieser Sequenz werden zwei zentrale Aufrufe von \gls{snort} im \gls{praeprozessor} \gls{sppname} dargestellt. Zum einen im oberen Teil die Initialisierung des \gls{praeprozessor}s durch einen Init-Aufruf, sowie der \gls{praeprozessor}-interne Aufbau des DissectorRegisters. Dieser Registrierungsvorgang wurde im Diagramm aus Platzgründen eingespart. Darin wird jeder als C Datei vorhandene Dissector instanziiert und bei dem DissectorRegister: TopLevelRegister registriert. Dieser Vorgang legt die Grundlage für den Ablauf des Dissectorbaums, welcher exemplarisch als zweiter unterer Teil des Sequenzdiagramms modelliert wurde. Für jedes empfangene Paket ruft \gls{snort} die detectProfinetPackets Methode in \gls{sppname} auf und übergibt einen Paketpointer. Basierend auf dem Ethertypen wählt das TopLevelRegister den ersten Dissector für ProfiNet RealTimes (0x8892 Ethertype) aus und übergibt den Paketpointer. \gls{sppname} ruft in diesem Dissector die dissect Methode auf, welche basierend auf gefundenen Informationen, einen passenden Subdissector aufrut. Hier wird der RT1Dissector aufgerufen und mit der dissect Methode gestartet. Dieser rekursive Schritt wird solange wiederholt, bis kein Subdissector mehr vorhanden ist bzw. das Ende des \gls{paket}s gefunden wurde.
Nach der Rückkehr der Methoden wird der fertige ProtocolTree benutzt und ausgelesen, um ein neues \gls{truffle} zu erstellen. Das \gls{truffle} wird am Ende durch einen speziellen Sender dem Client zur Verfügung gestellt (z.B. ein UnixSocketSender wie im UML Diagramm in Kapitel~\ref{fig:spp_uml}).

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{../diagramimages/spp-profinet-package-dissection.png}
  \caption[Sequenzdiagramm \gls{sppname} package dissection]{Sequenzdiagramm \gls{sppname} package dissection}
  \label{fig:spp_sqd}
\end{figure} 